# Jakarta EE EJB Timer Session Project Justfile
# Run `just` to see available recipes

# Set shell
set shell := ["bash", "-c"]

# Default recipe - shows available commands
default:
    @just --list

# Build the WAR file using Maven
build:
    @echo "Building the ejb-timersession WAR file..."
    ./mvnw clean package

# Clean build artifacts
clean:
    @echo "Cleaning build artifacts..."
    ./mvnw clean

# Compile without packaging
compile:
    @echo "Compiling Java sources..."
    ./mvnw compile

# Run tests
test:
    @echo "Running tests..."
    ./mvnw test

# Build Docker image
docker-build:
    @echo "Building Docker image..."
    just build
    docker build -t ejb-timersession-glassfish7:latest .

# Start application with Docker-Compose
up:
    @echo "Starting application with Docker-Compose..."
    docker-compose up -d

# Stop Docker-Compose services
down:
    @echo "Stopping Docker-Compose services..."
    docker-compose down

# View Docker-Compose logs
logs:
    @echo "Viewing application logs..."
    docker-compose logs -f

# Restart services
restart:
    @echo "Restarting services..."
    just down
    just up

# Show service status
status:
    @echo "Showing service status..."
    docker-compose ps

# Deploy application locally (without Docker)
deploy-local: build
    @echo "Deploying to local GlassFish..."
    @echo "Please ensure GlassFish is running and deploy target/timersession.war manually"

# Development mode - rebuild and restart
dev: build docker-build restart
    @echo "Development deployment complete"
    @echo "Application should be available at http://localhost:10085/timersession/"

# Build and deploy (docker-build + up)
deploy: docker-build up
    @echo "Application deployed successfully!"
    @echo ""
    @echo "Access the application at: http://localhost:10085/timersession/"
    @echo "Access GlassFish admin console at: http://localhost:10152/"

# Show project and deployment information
info:
    @echo "=== EJB Timer Session Project Info ==="
    @echo "Project: jakarta.examples.tutorial.ejb.timersession"
    @echo "Artifact: timersession"
    @echo "Version: 10-SNAPSHOT"
    @echo "Packaging: war"
    @echo ""
    @echo "=== Docker Deployment ==="
    @echo "Application URL: http://localhost:10085/timersession/"
    @echo "Admin Console: http://localhost:10152/"
    @echo "HTTPS URL: https://localhost:10184/timersession/"
    @echo ""
    @echo "=== Available Commands ==="
    @just --list
